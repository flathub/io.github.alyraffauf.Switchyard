app-id: io.github.alyraffauf.Switchyard
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
command: switchyard

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --talk-name=org.freedesktop.Flatpak
  - --filesystem=/var/lib/flatpak:ro
  - --filesystem=/var/lib/snapd:ro
  - --filesystem=host:ro
  - --filesystem=xdg-data/applications:ro
  - --filesystem=xdg-data/flatpak:ro

modules:
  - name: glib
    buildsystem: meson
    config-opts:
      - -Dtests=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/glib/2.86/glib-2.86.3.tar.xz
        sha256: b3211d8d34b9df5dca05787ef0ad5d7ca75dec998b970e1aab0001d229977c65
      - type: patch
        path: build-aux/flatpak/glib-appinfo.patch

  - name: switchyard
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/golang/bin
    build-commands:
      - |
        . /usr/lib/sdk/golang/enable.sh
        go build -mod=vendor -trimpath -o switchyard-bin ./src
      - install -Dm755 switchyard-bin /app/bin/switchyard-bin
      - install -Dm755 flatpak/switchyard-wrapper.sh /app/bin/switchyard
      - install -Dm644 data/io.github.alyraffauf.Switchyard.desktop /app/share/applications/io.github.alyraffauf.Switchyard.desktop
      - install -Dm644 data/io.github.alyraffauf.Switchyard.metainfo.xml /app/share/metainfo/io.github.alyraffauf.Switchyard.metainfo.xml
      - install -Dm644 data/icons/hicolor/scalable/apps/io.github.alyraffauf.Switchyard.svg /app/share/icons/hicolor/scalable/apps/io.github.alyraffauf.Switchyard.svg
    sources:
      - type: git
        url: https://github.com/alyraffauf/switchyard
        tag: v0.11.0
        commit: f1152297ed5a76065196a4cf1ff26f78ce53b746
